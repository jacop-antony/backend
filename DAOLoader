package com.tap;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.sql.*;

public class ProductCSVLoader {
public static void main(String[] args) {
String jdbcURL = "jdbc:mysql://localhost:3306/ecommerce";
String username = "root";
String password = "Jacop@15";
String csvFilePath = "csv_data/products.csv";

Connection connection = null;

try {
connection = DriverManager.getConnection(jdbcURL, username, password);
connection.setAutoCommit(false); // transaction safe

String sql = "INSERT INTO products (productid, name, price, stock) VALUES (?, ?, ?, ?)";
PreparedStatement statement = connection.prepareStatement(sql);

BufferedReader reader = new BufferedReader(new FileReader(csvFilePath));
String line;
int count = 0;

reader.readLine(); // Skip header line

while ((line = reader.readLine()) != null) {
String[] data = line.split(",");

int id = Integer.parseInt(data[0]);
String name = data[1];
double price = Double.parseDouble(data[2]);
int stock = Integer.parseInt(data[3]);

statement.setInt(1, id);
statement.setString(2, name);
statement.setDouble(3, price);
statement.setInt(4, stock);

statement.addBatch();
count++;

// Optional: execute batch every 100 records
if (count % 100 == 0) {
statement.executeBatch();
}
}

statement.executeBatch(); // execute remaining
connection.commit();
reader.close();
statement.close();
connection.close();

System.out.println("Data inserted successfully from CSV!");

} catch (IOException | SQLException e) {
e.printStackTrace();
try {
if (connection != null) {
connection.rollback(); // rollback on error
}
} catch (SQLException ex) {
ex.printStackTrace();
 }
    }
   }
  }
